---
title: "Differential expression analysis"
author: "Andr√© F. B. Menezes"
date: "`r format(Sys.time(), '%B %d, %Y')`"
toc: true
number-sections: true
format:
  html:
    html-math-method: katex
    code-tools: true
    self-contained: true
    code-fold: true
    code-summary: "Show the code"
execute:
  warning: false
---


# Introduction {#sec-intro}

In this report we will perform a differential expression analysis. 

```{r}
fts <- readRDS(file = "../data/fts_processed.rds")
fts[["proteins"]]
rowData(fts[["proteins"]])
se <- fts[["proteins"]]
mean(assay(se, "log2_normalized")["ACQ41977.1", ])
# Filters out the variable proteins
chosen_proteins <- rownames(se)[rowData(se)$bio > 0]
dim(se)
length(chosen_proteins)
```

```{r}
se_curr <- se[chosen_proteins, ]
assay(se)
g <- factor(colData(se)$group)
g <- relevel(g, ref = "Control")

design_matrix <- model.matrix(~ g)
colnames(design_matrix) <- levels(g)

# Fitting linear model --------------------------------------------------------
fit <- limma::lmFit(object = assay(se, "log2_normalized"), design_matrix)
fit <- limma::eBayes(fit)

ampicillin_control <- limma::topTable(fit, coef = "Ampicillin", number = Inf,
                               sort.by = "none", confint = TRUE)
cefotaxime_control <- limma::topTable(fit, coef = "Cefotaxime", number = Inf,
                               sort.by = "none", confint = TRUE)
impipenem_control <- limma::topTable(fit, coef = "Impipenem", number = Inf,
                              sort.by = "none", confint = TRUE)
ciprofloxacin_control <- limma::topTable(fit, coef = "Ciprofloxacin", number = Inf,
                                  sort.by = "none", confint = TRUE)

```

```{r}
x <- assay(se, "log2_normalized")["ACQ41977.1", ]
x_contrl <- x[10:12]
x_amp <- x[1:3]
mean(x_amp - x_contrl)
```

